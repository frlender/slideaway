var idx=window.location.href.lastIndexOf("/"),baseUrl=window.location.href.slice(0,idx+1);require.config({baseUrl:baseUrl,paths:{echarts:"libraries/echarts/build/dist",app:"dist"}}),require(["echarts/echarts","echarts/chart/scatter","app/SearchBox"],function(a,b,c){var d=require("echarts/config"),e=a.init(document.getElementById("main"));option={title:{text:"LINCS Milestones Overview",subtext:"An interactive plot",padding:0},tooltip:{trigger:"axis",showDelay:0,axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}}},toolbox:{show:!0,feature:{mark:{show:!0,title:{mark:"enable/disablemarkline",markUndo:"undo mark line",markClear:"clear mark line"}},dataZoom:{show:!0,title:{dataZoom:"zoom in selected region",dataZoomReset:"zoom out"}},restore:{show:!0,title:"restore"},saveAsImage:{show:!0,title:"save as image"}}},xAxis:[{type:"value",scale:!0,name:"perturbagen"}],yAxis:[{type:"value",scale:!0,name:"cell"}]},$.getJSON("data/chartInput",function(a){option.tooltip.formatter=function(b){return a.perts[b.value[0]-1].pert+", "+a.cells[b.value[1]-1].cell+" <br/>"+a.tooltip[b.value[0]][b.value[1]].centerAssays},option.xAxis[0].axisLabel={formatter:function(b){return b>a.perts.length||0>=b?"":a.perts[b-1].pert},interval:function(a){return!0}},option.yAxis[0].axisLabel={formatter:function(b){return b>a.cells.length||0>=b?"":a.cells[b-1].cell},interval:0};var b={"LINCS Transcriptomics":"#0B609A","LINCS PCCSE":"#0B609A","HMS LINCS":"#C90016",DTOXS:"#17becf","MEP LINCS":"#2ca02c",NeuroLINCS:"#bcbd22"},f={image:"emptyRectangle",transcriptomic:"emptyTriangle",proteomic:"emptyCircle",phenotypic:"emptyDiamond"};option.color=[],option.symbolList=[],a.centerAssays.forEach(function(a){option.color.push(b[a[0]]),option.symbolList.push(f[a[1]])}),option.series=[],a.centerAssays.forEach(function(b,c){var d={};d.name=b[0]+" ,"+b[1],d.type="scatter",d.data=a.serieses[c],"proteomic"==b[1]&&(d.symbolSize=5.5),"image"==b[1]&&(d.symbolSize=5.5),option.series.push(d)}),pertClassCount={},currentClass=a.perts[0].pertClass,count=0,a.perts.forEach(function(a,b){a.pertClass==currentClass?count+=1:(pertClassCount[currentClass]={},pertClassCount[currentClass].count=count,pertClassCount[currentClass].x=b,count=1,currentClass=a.pertClass)}),option.series.push({name:"external perturbations end here",type:"scatter",data:[[]],markLine:{data:[[{name:"",value:pertClassCount.external.count,xAxis:pertClassCount.external.x+.5,yAxis:-10},{name:"",xAxis:pertClassCount.external.x+.5,yAxis:58}]]}}),option.series.push({name:"genetic perturbations end here",type:"scatter",data:[[]],markLine:{data:[[{name:"",value:pertClassCount.genetic.count,xAxis:pertClassCount.genetic.x+.5,yAxis:-10},{name:"",xAxis:pertClassCount.genetic.x+.5,yAxis:58}]]}}),option.series.push({name:"microenvironment perturbations end here",type:"scatter",data:[[]],markLine:{data:[[{name:"",value:pertClassCount.microenvironment.count,xAxis:pertClassCount.microenvironment.x+.5,yAxis:-10},{name:"",xAxis:pertClassCount.microenvironment.x+.5,yAxis:58}]]}}),e.setOption(option),e.on(d.EVENT.CLICK,function(b,c){var d={};d.pert=a.perts[b.data[0]-1].pert,d.cell=a.cells[b.data[1]-1].cell,d.ids=a.tooltip[b.data[0]][b.data[1]].ids,$(herald).trigger("item:click",d)}),$("#dView").draggable({}),c(a,option,e)})});var app=angular.module("chart",["indexCtrl","services"]),herald={},indexCtrl=angular.module("indexCtrl",[]);indexCtrl.controller("tagTable",["$scope",function(a){$(herald).bind("query:change",function(b,c){a.perts=c.pert.items,a.cells=c.cell.items,a.$digest()}),a.removeCell=function(b){var c=_.findIndex(a.cells,function(a){return a.idx==b.idx});a.cells.splice(c,1),$(herald).trigger("cellTags:change",c)},a.removePert=function(b){var c=_.findIndex(a.perts,function(a){return a.idx==b.idx});a.perts.splice(c,1),$(herald).trigger("pertTags:change",c)}}]).controller("legendCenter",["$scope","centerMap",function(a,b){a.centerMap=b,a.centers=["DTOXS","HMS LINCS","MEP LINCS","NeuroLINCS","LINCS PCCSE","LINCS Transcriptomics"]}]).controller("draggable",["$scope","centerMap","$http",function(a,b,c){a.centerMap=b,a.show=!1,$(herald).bind("item:click",function(b,d){a.pert=d.pert,a.cell=d.cell,c.get(baseUrl+"meta?ids="+JSON.stringify(d.ids)).success(function(b){a.milestones=_.map(b,function(a){var b={};return a.assay.length>a["assay-info"].length&&"ISMMS-Iyengar"!=a.center?(b.assay=a["assay-info"],b.assayInfo=a.assay):(b.assay=a.assay,b.assayInfo=a["assay-info"]),b.center=a.center,b}),a.show=!0})}),a.close=function(){a.show=!1}}]);var services=angular.module("services",[]);services.factory("centerMap",function(){return{"LINCS Transcriptomics":{fullName:"LINCS Center for Transcriptomics",url:"http://www.lincscloud.org/",logo:"css/img/Broad_T.png",initial:"T",color:"#0B609A"},"LINCS PCCSE":{fullName:"LINCS Proteomic Characterization Center for Signaling and Epigenetics",url:"http://www.lincsproject.org/centers/data-and-signature-generating-centers/broad-prx/",logo:"css/img/Broad_P.png",initial:"P",color:"#0B609A"},"HMS LINCS":{fullName:"HMS LINCS",url:"http://lincs.hms.harvard.edu/",logo:"css/img/HMS_H.png",initial:"H",color:"#C90016"},DTOXS:{fullName:"DToxS",url:"http://research.mssm.edu/pst/DToxS/index.htm",logo:"css/img/DTOXS_D.png",initial:"D",color:"#00AEEF"},"MEP LINCS":{fullName:"MEP LINCS",url:"http://www.lincsproject.org/centers/data-and-signature-generating-centers/oregon-u/",logo:"css/img/MEP_M.png",initial:"M",color:"#66cc33"},NeuroLINCS:{fullName:"NeuroLINCS",url:"http://www.lincsproject.org/centers/data-and-signature-generating-centers/neurolincs/",logo:"css/img/NeuroLINCS_N.png",initial:"N",color:"#ffd200"}}}),$(".header").click(function(){$header=$(this),$content=$header.next(),$content.slideToggle(500,function(){$header.text(function(){return $content.is(":visible"),"Entires not included"})})});