define([],function(){function a(a,b,c){function d(){var a=g.pert.idx.length,d=g.cell.idx.length;if(d||a){var h=JSON.parse(JSON.stringify(f));e.forEach(function(b,c){h[c].data=_.filter(b.data,function(b){var c=!1,e=!1;return c=a?_.contains(g.pert.idx,b[0]):!0,e=d?_.contains(g.cell.idx,b[1]):!0,e&&c})}),b.series=h,c.setOption(b,!0)}else b.series=e,c.setOption(b,!0)}var e=b.series,f=JSON.parse(JSON.stringify(b.series));f.forEach(function(a){delete a.data});var g={};g.pert={},g.pert.items=[],g.pert.idx=[],g.cell={},g.cell.items=[],g.cell.idx=[],a.perts.forEach(function(a,b){a.idx=b+1}),a.cells.forEach(function(a,b){a.idx=b+1});var h=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("pert"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:5,local:a.perts}),i=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("cell"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:5,local:a.cells});h.initialize(),i.initialize(),$("#search .typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"perturbagens",displayKey:"pert",source:h.ttAdapter(),templates:{header:'<h3 class="league-name">Perturbagens</h3>'}},{name:"cells",displayKey:"cell",source:i.ttAdapter(),templates:{header:'<h3 class="league-name">Cells</h3>'}}).on("typeahead:selected",function(a,b,c){var e,f;"perturbagens"==c?(e="pert",f="pertClass"):"cells"==c&&(e="cell",f="cellType"),_.contains(g[e].idx,b.idx)||(g[e].items.push(b),g[e].idx.push(b.idx),$(herald).trigger("query:change",g),d())}),$(herald).bind("cellTags:change",function(a,b){g.cell.idx.splice(b,1),d()}),$(herald).bind("pertTags:change",function(a,b){g.pert.idx.splice(b,1),d()})}return a});